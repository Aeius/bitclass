# JPA
### properties
``` properties
# DB Connection
spring.datasource.dbcp2.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://192.168.99.100:3306/mydb
spring.datasource.username=scott
spring.datasource.password=tiger

# jpa
spring.jpa.show-sql=true
spring.jpa.hibernate.ddl-auto=create-drop

# logging slf4j
logging.level.web=info
logging.level.com.bit.boot06=debug
```
```
spring.jpa.hibernate.ddl-auto=?
create : 기존테이블 삭제 후 다시 생성
create-drop: create와 같으나 종료시점에 테이블 DROP
update: 변경분만 반영
validate: 엔티티와 테이블이 정상 매핑되었는지만 확인
none: 사용하지 않음
```
### Entity
``` java
import ...;

@Builder
@NoArgsConstructor
@AllArgsConstructor
@ToString
@Getter
@Entity
@Table(name = "dept03")
public class Dept03 {
	@Id // pk
//	@GeneratedValue(strategy = GenerationType.AUTO) // auto_increment
	private long deptno;
//	@Column(name = "domainname", columnDefinition = "varchar(8) default '제목없음'", nullable = false)
	@Column(columnDefinition = "varchar(8)")
	private String dname;
//	@Column(name = "location", columnDefinition = "text not null")
	private String loc;
	
	
	public ResponseDeptVo getEntity() {
		return ResponseDeptVo.builder()
				.deptno(deptno)
				.dname(dname)
				.loc(loc).build();
	}
	
}
```
### Repository
JpaRepository를 상속받기만 해도 기본적인 CRUD와 관련된 메서드들이 구현되어있으며 바로 사용 할 수 있다.   
``` java
package com.bit.boot06.domain;

import org.springframework.data.jpa.repository.JpaRepository;

import com.bit.boot06.domain.entity.Dept03;

public interface DeptRepo extends JpaRepository<Dept03, Long>{

}
```
### Entity Test (Junit 5 jupiter)
``` java
package com.bit.boot06.domain;


import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import com.bit.boot06.domain.entity.Dept03;

@SpringBootTest
public class DeptRepoTest {
	@Autowired
	private DeptRepo deptRepo;
	
	@Test
	public void test() {
		Dept03 entity = Dept03.builder()
				.deptno(1111)
				.dname("teset")
				.loc("test")
				.build();
		deptRepo.save(entity);
	}

}
```
### Service
``` java
package com.bit.boot06.service;

import org.springframework.stereotype.Service;

import com.bit.boot06.domain.DeptRepo;
import com.bit.boot06.domain.RequestDeptVo;
import com.bit.boot06.domain.ResponseDeptVo;
import com.bit.boot06.domain.entity.Dept03;

import lombok.AllArgsConstructor;

@Service
@AllArgsConstructor
public class DeptService {
	
	private final DeptRepo deptRepo;
	
	ResponseDeptVo insertOne(RequestDeptVo bean) {
		Dept03 entity = Dept03.builder()
				.deptno(bean.getDeptno())
				.dname(bean.getDname())
				.loc(bean.getLoc())
				.build();
		return deptRepo.save(entity).getEntity();
	}
	
	
	ResponseDeptVo selectOne(long deptno) {
		return deptRepo.findById(deptno).get().getEntity();
	}
}
```
### Service Test (Junit 5 jupiter)
``` java
package com.bit.boot06.service;

import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.annotation.Commit;
import org.springframework.transaction.annotation.Transactional;

import com.bit.boot06.domain.RequestDeptVo;
import com.bit.boot06.domain.ResponseDeptVo;

import lombok.extern.slf4j.Slf4j;

@SpringBootTest
@Slf4j
class DeptServiceTest {
	@Autowired
	DeptService deptService;
	RequestDeptVo target ;
	
	@BeforeEach
	public void before() {
		target = RequestDeptVo.builder()
				.deptno(4444)
				.dname("test4")
				.loc("test")
				.build();
	}
	
	@Test
	@Transactional
	@Commit
	void test() {
//		assertNotNull(deptService);
		
		ResponseDeptVo result = deptService.insertOne(RequestDeptVo.builder()
				.deptno(target.getDeptno())
				.dname(target.getDname())
				.loc(target.getLoc())
				.build());
		log.debug(result.toString());
		assertEquals(target.getDeptno(), result.getDeptno());
		assertEquals(target.getDname(), result.getDname());
		assertEquals(target.getLoc(), result.getLoc());
	}
	
	@Test
	public void test2() {
		ResponseDeptVo result = deptService.selectOne(target.getDeptno());
		log.debug(result.toString());
		assertEquals(target.getDeptno(), result.getDeptno());
		assertEquals(target.getDname(), result.getDname());
		assertEquals(target.getLoc(), result.getLoc());
	}
}
```
